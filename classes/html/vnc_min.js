var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(h,q,G){h!=Array.prototype&&h!=Object.prototype&&(h[q]=G.value)};$jscomp.getGlobal=function(h){return"undefined"!=typeof window&&window===h?h:"undefined"!=typeof global&&null!=global?global:h};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(h){return $jscomp.SYMBOL_PREFIX+(h||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var h=$jscomp.global.Symbol.iterator;h||(h=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[h]&&$jscomp.defineProperty(Array.prototype,h,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(h){var q=0;return $jscomp.iteratorPrototype(function(){return q<h.length?{done:!1,value:h[q++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(h){$jscomp.initSymbolIterator();h={next:h};h[$jscomp.global.Symbol.iterator]=function(){return this};return h};$jscomp.iteratorFromArray=function(h,q){$jscomp.initSymbolIterator();h instanceof String&&(h+="");var G=0,J={next:function(){if(G<h.length){var P=G++;return{value:q(P,h[P]),done:!1}}J.next=function(){return{done:!0,value:void 0}};return J.next()}};J[Symbol.iterator]=function(){return J};return J};
$jscomp.polyfill=function(h,q,G,J){if(q){G=$jscomp.global;h=h.split(".");for(J=0;J<h.length-1;J++){var P=h[J];P in G||(G[P]={});G=G[P]}h=h[h.length-1];J=G[h];q=q(J);q!=J&&null!=q&&$jscomp.defineProperty(G,h,{configurable:!0,writable:!0,value:q})}};$jscomp.polyfill("Array.prototype.keys",function(h){return h?h:function(){return $jscomp.iteratorFromArray(this,function(h){return h})}},"es6-impl","es3");var svManager={getInstance:function(){var h=window.$vnc;return h&&h.running&&h.running()?h:null}};
function connvertServer(h){var q={};q.id=h.id;q.server=h.id;q.displayName=h.displayName||h.id;if(h=h.vnc){for(var G in h)q[G]=h[G];q.pwd=h.password||""}return q}
svGlobal.Vnc=function(h,q,G,J){function P(a){return"on"==a||"true"==a}function Ja(a,b){function e(a){a-l>c&&0<d.width&&(z.repaint(d.x,d.y,d.width,d.height),d.width=0,l=a);M=requestAnimationFrame(e)}var f=[],g=null,d=new hi5.graphic.Rectangle(0,0,0,0),k="Uint8ClampedArray"in window;this.width=a;this.height=b;var c=y.animation||62,h=!1,z=this,E=null,l=0,M=0;this.pause=function(a){h=a};this.release=function(){cancelAnimationFrame(M);E=f=g=z=null};this.isPaused=function(){return h};this.setContext=function(d){d!=
g&&(g||!d||d.createImageData(1,1).data.buffer||(k=!1),g=d,null!=g&&(E=g.createImageData(a,b)))};this.getContext=function(){return g};this.resize=function(d,e){for(var m=0;m<e;m++)f[m]=new Uint32Array(d);z.width=a=d;z.height=b=e;null!=g&&(E=g.createImageData(a,b))};z.resize(a,b);this.getBuffer=function(){return f};this.setRGB=function(a,b,d){f[b][a]=d|4278190080};this.getRGB=function(a,b){return f[b][a]};this.setRGBs=function(a,b,d,e,g,k,c){var m=a+d;e=b+e;if(g.subarray)for(;b<e;b++,k+=c)f[b].set(g.subarray(k,
k+d),a);else for(var p;b<e;b++,k+=c){var v=k;p=f[b];for(d=a;d<m;d++)p[d]=g[v++]}};this.moveArea=function(a,b,d,e,g,k){if(0<k)for(g=a+g,k=b+k,--e;0<=e;e--)f[k+e].set(f[b+e].subarray(a,a+d),g);else if(0>k){g=a+g;k=b+k;for(var m=0;m<e;m++)f[k+m].set(f[b+m].subarray(a,a+d),g)}else if(0<g){g=a+g;k=b+k;var m=f,c;for(--d;0<=d;d--){var p=g+d;var h=a+d;for(c=0;c<e;c++)m[k+c][p]=m[b+c][h]}}else{g=a+g;k=b+k;var m=f;for(c=0;c<d;c++){h=g+c;var v=a+c;for(p=0;p<e;p++)m[k+p][h]=m[b+p][v]}}};this.getRGBs=function(a,
b,d,g){var e=_Uint32Array(d*g);e[0]=0;var m=f;d=a+d;g=b+g;for(var k=0,c=b;c<g;c++)for(b=a;b<d;b++)e[k++]=m[c][b];return e};this.repaint=function(d,e,c,h){var m=E.data,p=0,H,v;0>d&&(c+=d,d=0);0>e&&(h+=e,e=0);d+c>a&&(c=a-d);e+h>b&&(h=b-e);var r=d+c;var z=e+h;if(k)for(m=new Uint32Array(m.buffer),v=e;v<z;v++)m.set(f[v].subarray(d,r),p),p+=a;else{var l=4*(a-c)|0;for(v=e;v<z;v++){for(H=d;H<r;H++){var M=f[v][H];m[p++]=M&255;m[p++]=M>>8&255;m[p++]=M>>16&255;m[p++]=255}p+=l}}g.putImageData(E,d,e,0,0,c,h)};
this.postPaint=function(a,b,e,g){0<d.width?d.union(a,b,e,g):(d.x=a,d.y=b,d.width=e,d.height=g)};this.commitPaint=function(){0<d.width&&(this.repaint(d.x,d.y,d.width,d.height),d.width=0)};this.startAnimation=function(){M=requestAnimationFrame(e)};this.fillRect=function(a,b,d,e,g){d=a+d;e=b+e;for(var k=b;k<e;k++)if(f[k].fill)f[k].fill(g,a,d);else{var c=f[k];for(b=a;b<d;b++)c[b]=g}}}function xa(){var a=h.indexOf("://"),b=h.substring(a+3),a=b.indexOf("/");0<a&&(b=b.substring(0,a));return location.protocol+
"//"+b}function t(a){K&&x.send(a)}function Ka(a){if(!ga)return"";a=hi5.browser.httpGet(xa()+"/CLIP?s="+ga+"&t="+Date.now(),!1);setTimeout(function(){x.send("883")},999);return a}function X(a,b,e){this.need=a;this.handler=b;this.repeat=e||1}function ya(a){var b=0,e=0,f=new Uint8Array(a),g=this,d=new X(0,null,0);this.release=function(){g=f=d=null};this.getHandler=function(){return d};this.getData=function(){return f};this.getPosition=function(){return b};this.setPosition=function(a){b=a};this.getEnd=
function(){return e};this.set=function(a,d,g){f=a;b=d;e=g};this.handle=function(){d.handler(g,d)};this.setHandler=function(a){a&&1>a.need&&svGlobal.logger.warn("need < 1");(d=a)&&e-b>=a.need&&a.handler(g,a)};this.getByte=function(){return f[b++]};this.peekByte=function(){return f[b]};this.getBE32=function(){return f[b++]<<24|f[b++]<<16|f[b++]<<8|f[b++]};this.getBE16=function(){return f[b++]<<8|f[b++]};this.skip=function(a){b+=a};this.skipBack=function(a){b-=a};this.getBytes=function(a,d){if(d)for(var e=
0;e<a;e++)d[e]=f[b++];else return e=b,b+=a,f.subarray(e,b)};this.copyToByteArray=function(a,b,d,e){hi5.Arrays.arraycopy(f,d,a,b,e)};this.getString16LE=function(a,b){for(var d="",e=a;e<b;)var g=f[e++]|f[e++]<<8,d=d+String.fromCharCode(g);return d}}function za(){var a="";l&&P(l.connectif)&&l.symlink&&"sessionStorage"in window&&(a="SV_"+l.symlink,l.user&&(a+=l.user));return a}function La(){var a=za(),b="";a&&(b=sessionStorage[a]||"")&&(b="&preSymJoin="+b);return b}function Ma(){if(!K){if(ja)x=ja,ea(l.width,
l.height);else{var a=hi5.tool.replaceQuery(h,"pwd","x")+La();hi5.browser.binaryWS()&&(a+="&binary=on");var b=window.opener;if(b){var e=null;try{e=b.__sparkUser}catch(g){}e&&(b=e.account,e=e.session,b&&(a+="&account="+b),e&&(a+="&session="+e))}a=c.modifyURL(a+("&pasteCap="+(hi5.browser.isChrome&&hi5.browser.isDesktop?3:0)));(e=hi5.browser.cookie.get("__SV_TOKEN_A"))&&(a+="&__SV_TOKEN_A="+encodeURIComponent(e));x=new WebSocket(a,"vnc");x.binaryType="arraybuffer"}Z.ws=x;svGlobal.logger.info(h);x.onopen=
Na;var f=new hi5.DataBuffer([],0,0);x.onmessage=function(a){a=a.data;if("string"!=typeof a){var b=new Uint8Array(a);null!=V&&V.add(new RecordingObj(b,0,a.byteLength));switch(b[0]){case 48:C.set(b,2,b-2);C.handle();break;case 56:f.attach(b,2,b.length-2);Aa(f.getUnicodeString(f.getEnd()-f.getPosition(),!1));break;case 60:if(ha||ia)switch(f.attach(b,2,b.length-2),f.getByte()){case 32:if(A&&!A.isPaused()){a=f.getLittleEndian16();b=f.getLittleEndian16();var e=f.getLittleEndian16();var g=f.getLittleEndian32(),
h=c.sessionInfo.appInfo.sessions[g];n&&n.moveCursor(b,e,!0,h,g,a)}}break;case 62:f.attach(b,2,b.length-2);ka(f.getUnicodeString(f.getEnd()-f.getPosition(),!1));break;case 146:f.attach(b,2,b.length-2);switch(f.getByte()){case 0:a=new Uint8Array(2);a[0]=146;a[1]=1;t(a.buffer);break;case 1:Q&&Q.check();break;case 6:Z.remoteLockFlags=f.getLittleEndian32(),Z.checkLockFlags=!0}break;default:svGlobal.logger.warn("invalid type:"+b[0])}}else switch(e=parseInt(a.substring(0,2),16),b=a.substring(2),e){case 26:a=
JSON.parse(b);if(a.name){svGlobal.logger.info("msg="+b);if(c.onerror)c.onerror(a);b=__svi18n.errorCode["S"+a.name]||"";b+=a.message;c.showMessage(b)}else 0<svGlobal.log&&console.erro("No error code for message:"+b);break;case 27:0!=y.drawLicense&&n.drawLicense(b);break;case 56:Aa(b);break;case 59:a=hi5.Base64.dec(b,0);la=a[3]<<24|a[2]<<16|a[1]<<8|a[0];la&64&&c.showMessage(__svi18n.info.recording);n.setFeature(la);break;case 61:a=JSON.parse(b);switch(a.type){case 0:ea(a.width,a.height);L=a.color/8|
0;"ignoreCursor"in a&&(ma=a.ignoreCursor);"trackCursorLocally"in a&&(ha=a.trackCursorLocally,Ba(n));a.server&&(c.server=a.server,c.setTitle&&(document.title=l.displayName||c.server));n&&n.setAutoScale(!0);if(c.onopened)c.onopened(a);break;case 1:a=a.duration;if(c.onprogress)c.onprogress(a,void 0);break;case 2:2==a.status?(na(),K=!0):(b=0==a.status,A.pause(b),b||A.repaint(0,0,A.width,A.height),a.warn&&c.showMessage(b?__svi18n.info.sessionPaused:__svi18n.info.sessionResumed))}break;case 62:ka(b);break;
default:svGlobal.logger.warn("@TODO:"+a+"\n")}};x.onclose=fa;x.onerror=Oa}}function Pa(a,b){var e=0,f=!1;this.width=a;this.interval=b;var g=0;this.start=function(){f||(f=!0,e=setInterval(function(){if(n&&K){var b=n.getThumbnail(a);b&&b.length!=g&&(t("8E7"+b),g=b.length)}},b))};this.stop=function(){clearInterval(e)}}function Qa(a,b){!T||T.width==a&&T.interval==b||(T.stop(),T=null);T||(T=new Pa(a,b));T.start()}function Aa(a){a=JSON.parse(a);ga=a.session;a.server=c.server;var b=hi5.$("joinSelect");b&&
(b.value=a.joinMode);if(b=hi5.$("requestControl"))b.disabled=a.hasControl;a.joined||ia||(c.mode=0,C.setHandler(oa),aa=new pa);var b=y.page&&y.page.joinvnc||"joinvnc.html",b=location.protocol+"//"+location.host+"/"+b+"?id="+a.numericId,b=c.modifyURL(b),e=a.webAddress;if(e&&0<e.length){var f=e.indexOf("://"),e=e.substring(f+3),f=e.indexOf("/");0<f&&(e=e.substring(0,f));e.toLowerCase()!=location.host.toLowerCase()&&(b+="&gateway="+e)}a.joinLink=b;c.sessionInfo.appInfo=a;a.ver&&a.ver!=svGlobal.version&&
svGlobal.logger.info("Client:"+svGlobal.version+" server:"+a.ver);if(c.onsessionstart)c.onsessionstart(c.sessionInfo)}function Ba(a){ha?ma&&a.setCursor({system:"default",none:!1,result:"default"}):hi5.browser.isIE?a.setCursor({system:"none",none:!0,result:"none"}):a.setCursor({result:"url(data:image/x-icon;base64,AAACAAEAICACAAAAAAAwAQAAFgAAACgAAAAgAAAAQAAAAAEAAQAAAAAAgAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAABQUFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAOAAAADgAAAA//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8f////H////x////8=) 0 0, none"})}
function Na(a){svGlobal.logger.info("opened...");K=!0;t("87"+navigator.userAgent);if(c.onopen)c.onopen()}function Oa(a){svGlobal.logger.warn(a)}function fa(a){if(c){svGlobal.logger.warn("closed ...");(a=za())&&c.sessionInfo.appInfo&&0==c.mode&&(sessionStorage[a]=c.sessionInfo.appInfo.session);C&&C.getHandler()&&C.getHandler().handler==qa&&c.onautherror&&c.onautherror();da=K=!1;Q&&(Q.stop(),Q=null);if(c&&c.onclose)c.onclose(Ca);try{null!=V&&(V.exit(),V=null),n&&(n.onclipdata=null,n.close(),n=null)}catch(b){}U=
ra=Da=O=F=h=null;x&&(x.onopen=null,x.onmessage=null,x.onclose=null,x=x.onerror=null);C&&(C.release(),C=null);R&&(R.release(),R=null);aa&&(aa.release(),aa=null);n=Z=sa=oa=I=O=null;A&&(A.release(),A=null);c&&(c=null);window&&window.$vnc&&(window.$vnc=null);null!=V&&(V.exit(),V=null)}}function Ea(){var a=new Uint8Array(2);a[0]=147;a[1]=P(l.share)?1:0;t(a.buffer);C.setHandler(new X(24,function(a){if(c.onloggedin)c.onloggedin();t("8D");if(K){var b=c.sessionInfo;b.width=ba=a.getBE16();b.height=ca=a.getBE16();
b.bpp=a.getByte();b.depth=a.getByte();b.bigEndian=0!=a.getByte();b.trueColor=0!=a.getByte();b.redMax=a.getBE16();b.greenMax=a.getBE16();b.blueMax=a.getBE16();b.redShift=a.getByte();b.greenShift=a.getByte();b.blueShift=a.getByte();a.skip(3);for(var f=a.getBE32(),g="",d=0;d<f;d++)g+=String.fromCharCode(a.getByte());b.name=g;svGlobal.logger.info("server name:"+g);c.setTitle&&(document.title=g);ea(ba,ca);a=[];b=l.encoding;8==l.color&&"Tight"==b&&(b="ZRLE");switch(b){case "Tight":a.push(7);a.push(16);
a.push(5);a.push(0);break;case "Raw":a.push(0);a.push(16);a.push(7);a.push(5);a.push(0);16==l.color&&(l.color=32);break;case "Hextile":a.push(5);a.push(16);a.push(7);a.push(0);16==l.color&&(l.color=32);break;default:a.push(16),a.push(7),a.push(5),a.push(0),16==l.color&&(l.color=32)}a.push(1);ha&&(a.push(4294967057),a.push(4294967064));y.vnc&&!1===y.vnc.qemuExtKey||a.push(4294967038);a.push(4294967035);"0"!=l.compression&&a.push(4294967040+parseInt(l.compression||6));"0"!=l.quality&&a.push(4294967264+
parseInt(l.quality||5));a.push(4294967073);b=a.length;f=new Uint8Array(5+4*b);f[0]=147;f[1]=2;f[3]=b>>8&255;f[4]=b&255;for(g=0;g<b;g++)f[5+4*g]=a[g]>>24&255,f[6+4*g]=a[g]>>16&255,f[7+4*g]=a[g]>>8&255,f[8+4*g]=a[g]&255;t(f.buffer);a=parseInt(l.color);switch(a){case 32:ta(32,24,!1,!0,255,255,255,0,8,16);break;case 16:ta(16,16,!1,!0,31,63,31,11,5,0);break;case 8:ta(8,8,!1,!0,7,7,3,0,3,6);break;default:svGlobal.logger.warn("invliad color depath:"+a)}L=a/8|0;R&&R.setBytesPerPixel(L);ua(0,0,ba,ca,!1);C&&
C.setHandler(sa);da=!0;void 0!=l.recording&&"on"==l.recording&&(a=l,V=new RecordingManager,V.setHeader({name:a.server,width:a.width,height:a.height,color:a.server_bpp,namesuffix:".vncv",filetag:"VNCV",duration:0}));if(c&&(y.pingInterval&&c.startPing(y.pingInterval),c.onready))c.onready()}}))}function qa(a){a=a.getBE32();svGlobal.logger.info("sec rst: "+a);var b={code:a,message:""};switch(a){case 0:Ea();return;case 1:b.message=__svi18n.vnc.authError;break;case 2:b.message="Too many failed authentication";
break;default:b.message="Unknown auth error"+a}C.setHandler(null);c.onautherror&&c.onautherror(b)||(c.showMessage(b.message),c.close())}function ta(a,b,e,f,g,d,c,h,r,z){var k=new Uint8Array(21);k[0]=147;k[1]=0;k[5]=a;k[6]=b;k[7]=e?1:0;k[8]=f?1:0;k[9]=g>>8&255;k[10]=g&255;k[11]=d>>8&255;k[12]=d&255;k[13]=c>>8&255;k[14]=c&255;k[15]=h;k[16]=r;k[17]=z;t(k.buffer)}function ua(a,b,e,f,g){var d=new Uint8Array(11);d[0]=147;d[1]=3;d[2]=g?1:0;d[3]=a>>8&255;d[4]=a&255;d[5]=b>>8&255;d[6]=b&255;d[7]=e>>8&255;
d[8]=e&255;d[9]=f>>8&255;d[10]=f&255;t(d.buffer)}function pa(){var a=new TINF;a.init(2==c.mode?120:0);var b=new ya(0),e=new Uint32Array(4096),f=new Uint32Array(128);this.release=function(){f=e=null;a.release();a=null;b.release();b=null};this.getHistory=function(){var b=[90],d=a.getHistory().length,e=d&255;b.push(d>>8&255);b.push(e);return b=b.concat(a.getHistory())};this.setHistory=function(b){a.setHistory(b)};this.decode=function(g,d,c,h,r,z){var k,H=g.getBE32();g=g.getBytes(H);g=a.uncompress(g,
0);b.set(g.dest,0,g.destIndex);var l=f,n,m=b.getByte,p=e;for(g=c;g<c+r;g+=64){var v=Math.min(c+r-g,64);for(H=d;H<d+h;H+=64){var N=Math.min(d+h-H,64);var u=m();var w=0!=(u&128);u&=127;if(1==L)for(k=0;k<u;k++)l[k]=Y[m()];else for(k=0;k<u;k++)l[k]=m()|m()<<8|m()<<16|4278190080;if(1!=u||z){if(w)if(0==u)for(u=0,n=u+N*v;u<n;){var S=1==L?Y[m()]:m()|m()<<8|m()<<16|4278190080;k=1;do w=m(),k+=w;while(255==w);if(p.fill)p.fill(S,u,u+k),u+=k;else for(;0<k--;)p[u++]=S}else for(u=0,n=u+N*v;u<n;){S=m();k=1;if(0!=
(S&128)){do w=m(),k+=w;while(255==w)}S&=127;S=l[S];if(p.fill)p.fill(S,u,u+k),u+=k;else for(;0<k--;)p[u++]=S}else if(w=N*v,0==u)if(1==L)for(k=0;k<w;k++)p[k]=Y[m()];else for(k=0;k<w;k++)p[k]=m()|m()<<8|m()<<16|4278190080;else for(n=16<u?8:4<u?4:2<u?2:1,k=u=0;k<v;k++){S=u+N;for(var t=w=0;u<S;)0==t&&(w=m(),t=8),t-=n,p[u++]=l[w>>t&(1<<n)-1&127]}z||A.setRGBs(H,g,N,v,p,0,N)}else A.fillRect(H,g,N,v,l[0])}}z||A.postPaint(d,c,h,r)}}function Fa(){function a(a,b,d,e,f){this.draw=function(){U.fillStyle=f;U.fillRect(a,
b,d,e)};this.type=0;this.ready=function(){return!0}}function b(a,b,d){this.draw=function(){U.putImageData(d,a,b)};this.type=1;this.ready=function(){return!0}}function e(a,b,d){this.draw=function(){U.drawImage(d,a,b)};this.type=2;this.ready=function(){return!!d.src&&d.complete};this.image=d}function f(){var a=z[h];a||(a=new TINF,a.init(2==c.mode?120:0),z[h]=a);return a}function g(a){var b=a.getByte(),d=b&127;b&128&&(b=a.getByte(),d|=(b&127)<<7,b&128&&(d|=a.getByte()<<14));return d}function d(a){if(3==
l)return"rgb("+a.getByte()+","+a.getByte()+","+a.getByte()+")";var b=a.getByte()|a.getByte()<<8;a=b>>8&248;var d=b>>3&252,b=b<<3&255;return"rgb("+(a|a>>5)+","+(d|d>>6)+","+(b|b>>5)+")"}function k(a){var b=a>>8&248,d=a>>3&252;a=a<<3&255;return b|b>>5|(d|d>>6)<<8|(a|a>>5)<<16|4278190080}var h=0,l=3,z={},n={data:[0],length:0},t=Array(256);t[0]=0;this.inUse=!1;var M=this;this.setBytesPerPixel=function(a){l=3<a?3:a};var A=new function(){function a(){for(;0<b.length;){var a=b[0];if(!a.ready())break;a.draw();
b.shift()}}var b=[];this.push=function(d){b.push(d);2==d.type?d.image.onload=a:a()}};this.release=function(){z=n=t=M=A=null};this.getHistory=function(){var a=[84],b=Object.keys(z).length;a.push(b);for(var d in z)if(z.hasOwnProperty(d)){a.push(parseInt(d));var b=z[d].getHistory(),e=b.length,f=e&255;a.push(e>>8&255);a.push(f);a=a.concat(b)}return a};this.setHistory=function(a){for(var b=0,d=a[b++],e=0;e<d;e++){var f=a[b++],k=a[b++],g=a[b++],g=(k&255)<<8|g&255,k=a.slice(b,b+g),b=b+g,g=z[f];g||(g=new TINF,
g.init(2==c.mode?120:0),z[f]=g);g.setHistory(k)}};this.drawImageData=function(a,d,e){A.push(new b(d,e,a))};this.decode=function(c,H,z,r,u,w){M.inUse||(M.inUse=!0);var m=c.getByte();switch(m>>4){case 8:w?c.skip(l):A.push(new a(H,z,r,u,d(c)));break;case 9:m=g(c);r=hi5.Base64.enc(c.getData(),m,c.getPosition());c.skip(m);w||(w=new Image,A.push(new e(H,z,w)),w.src="data:image/jpeg;base64,"+r);break;default:if(h=(m&48)>>4,m=m&64?c.getByte():0,1==m){m=c.getByte;var p=m()+1;var v=2!=p?r*u:u*((r+7)/8|0);var B=
0;var q;if(3==l)for(;B<p;B++)t[B]=m()|m()<<8|m()<<16|4278190080;else for(;B<p;B++)t[B]=k(m()|m()<<8);12>v?(n.data=c.getBytes(v),n.length=v):(m=g(c),c=f().uncompress(c.getBytes(m),0),n.data=c.dest,n.length=c.destIndex);var E=n.data;m=U.createImageData(r,u);if("Uint8ClampedArray"in window){var D=new Uint32Array(m.data.buffer);if(2!=p)for(B=0;B<v;B++)D[B]=t[E[B]];else{c=0;v=(r+7)/8|0;for(var N=0;N<u;N++){B=N*v;for(var x=0;x<(r/8|0);x++)for(p=E[B+x],q=7;0<=q;q--)D[c++]=t[p>>q&1];p=8-r%8;for(q=7;q>=p;q--)D[c++]=
t[E[B+x]>>q&1]}}}else if(D=m.data,c=0,2!=p)for(B=0;B<v;B++)p=t[E[B]],D[c++]=p&255,D[c++]=p>>8&255,D[c++]=p>>16&255,D[c++]=255;else{c=0;v=(r+7)/8|0;for(var y,N=0;N<u;N++){B=N*v;for(x=0;x<(r/8|0);x++)for(p=E[B+x],q=7;0<=q;q--)y=t[p>>q&1],D[c++]=y&255,D[c++]=y>>8&255,D[c++]=y>>16&255,D[c++]=255;p=8-r%8;for(q=7;q>=p;q--)y=t[E[B+x]>>q&1],D[c++]=y&255,D[c++]=y>>8&255,D[c++]=y>>16&255,D[c++]=255}}w||A.push(new b(H,z,m))}else if(0==m){m=r*u*l;11<m&&(m=g(c));p=r*u;E=p*l;E=11<E?f().uncompress(c.getBytes(m),
0).dest:c.getBytes(E);m=U.createImageData(r,u);D=m.data;r=c=0;if(3==l)for(B=0;B<p;B++)D[c++]=E[r++],D[c++]=E[r++],D[c++]=E[r++],D[c++]=255;else for(B=0;B<p;B++)u=k(E[r++]|E[r++]<<8),D[c++]=u&255,D[c++]=u>>8&255,D[c++]=u>>16&255,D[c++]=255;w||A.push(new b(H,z,m))}else svGlobal.logger.info("xx filter:"+m)}}}function ka(a){var b=parseInt(a.substring(0,1),16),e=a.substring(1),f=!1;var g=c.sessionInfo.appInfo;switch(b){case 0:var d=JSON.parse(e);na();K=!0;f=d.width;g=d.height;if(f==ba&&g==ca)break;ea(f,
g);break;case 1:c.reconnectOnResize=!1;d=JSON.parse(e);g.sessions[d.numericId]=d.name||d.__ip;c.onsessionjoin&&(f=c.onsessionjoin(d));if(f)break;c.showMessage(__svi18n.info.joinsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 2:d=JSON.parse(e);delete g.sessions[d.numericId];c.onsessionexit&&(f=c.onsessionexit(d));if(f)break;c.showMessage(__svi18n.info.exitsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 3:d=JSON.parse(e);g.joinMode!=d.mode&&(g.joinMode=d.mode,a=hi5.$("joinSelect"))&&
(a.value=d.mode);if(g.hasControl)break;n.setReadOnly(!1,2==d.mode);if(g=hi5.$("requestControl"))g.disabled=!0;c.ongivecontrol&&(f=c.ongivecontrol());if(f)break;c.showMessage(__svi18n.info.givecontrol);break;case 4:d=JSON.parse(e);n.setReadOnly(!0,2==d.mode);g.hasControl=!1;if(g=hi5.$("requestControl"))g.disabled=!1;c.ontakebackcontrol&&(f=c.ontakebackcontrol());if(f)break;c.showMessage(__svi18n.info.nocontrol);break;case 5:d=JSON.parse(e);c.onrequirecontrol&&(f=c.onrequirecontrol(d));if(f)break;f=
__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);hi5.notifications.notify({title:f,msg:__svi18n.info.recontrol,cbYes:function(){c.giveControl(d.numericId);this.destroy()},cbNo:function(){c.refuseControl(d.numericId);this.destroy()}});break;case 9:d=JSON.parse(e);0<d.interval&&0<d.width?Qa(d.width,d.interval):T&&(T.stop(),T=null);break;case 10:if(1==a.length)t("8E8"+hi5.Base64.enc(Ra()));else if(Sa(hi5.Base64.dec(a.substring(1),0)),c.refreshOutput(),da=!0,c.onloggedin)c.onloggedin();Q&&Q.check(15555);
break;case 11:d=JSON.parse(e),c.onrequirejoin&&(f=c.onrequirejoin(d)),f||(f=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]),hi5.notifications.notify({title:f,msg:__svi18n.info.reqjoin,cbYes:function(){c.allowJoin(d.numericId,!0);this.destroy()},cbNo:function(){c.allowJoin(d.numericId,!1);this.destroy()}}))}}function Ra(){var a=aa.getHistory(),b=R.getHistory();return a.concat(b)}function Sa(a){var b=0,e=a[b++];if(90==e){var e=a[b++],c=a[b++];if(e=(e&255)<<8|c&255)aa.setHistory(a.slice(b,
b+e)),b+=e}e=a[b++];84==e&&R.setHistory(a.slice(b))}function Ta(a){if(!c.openLink)return!1;var b=a;a=a.toLowerCase();var e=0==a.indexOf("http://")||0==a.indexOf("https://")||0==a.indexOf("ftp://")||0==a.indexOf("mailto:")||0==a.indexOf("tel:")||0==a.indexOf("callto:");e||(0==a.indexOf("www.")?(e=!0,a="http://"+a):0==a.indexOf("ftp.")&&(e=!0,a="ftp://"+a));if(e){if(0<a.indexOf("\r")||0<a.indexOf("\n"))return!1;if(c.onurlredirection&&c.onurlredirection(e))return!0;n.processLink(b);return!0}return!1}
function Ua(a,b,e,c,g,d,k,h,r){this.cache_idx=a;this.rawData=b;this.none=!b;this.hotX=e;this.hotY=c;this.width=g;this.height=d;this.xorSize=h;this.andSize=r;this.result="";this.distance=0;this.bpp=k;this.system="";this.init=function(){if(this.distance){var a=0;if(b)for(var d=0,e=b.length;d<e;d++)0!=b[d]&&(a+=d%g+(d/g|0));this.distance=a}this.system||(a=507==this.distance?"text":"",this.system=a)};a="";if(!this.system&&b){var f=g*d*4;k=62+f+h+r;var H=new Uint8Array(k);k=new hi5.DataBuffer(H,0,k);k.setLittleEndian16(0);
k.setLittleEndian16(2);k.setLittleEndian16(1);k.setByte(g);k.setByte(d);k.setByte(0);k.setByte(0);k.setLittleEndian16(e);k.setLittleEndian16(c);k.setLittleEndian32(40+f+h+r);k.setLittleEndian32(22);k.setLittleEndian32(40);k.setLittleEndian32(g);k.setLittleEndian32(2*d);k.setLittleEndian16(1);k.setLittleEndian16(32);k.setLittleEndian32(0);k.setLittleEndian32(h+r);k.setLittleEndian32(0);k.setLittleEndian32(0);k.setLittleEndian32(0);k.setLittleEndian32(0);for(e=d-1;0<=e;e--)for(c=0;c<g;c++)d=b[g*e+c],
k.setByte(d&255),k.setByte(d>>8&255),k.setByte(d>>16&255),k.setByte(d>>24&255);hi5.browser.isIE||(a="data:image/x-icon;base64,"+hi5.Base64.enc(k.getData()))}this.url=a}function Ga(a,b,e,c,g){var d=null,f=c*g,h=0,r=a.getPosition(),l=a.getData();if(R.inUse){d=U.createImageData(c,g);if(4==L){if("Uint8ClampedArray"in window)for(g=new Uint32Array(d.data.buffer),h=0;h<f;h++)g[h]=l[r++]<<16|l[r++]<<8|l[r++]|4278190080,r++;else for(g=d.data,c=4*f;h<c;)g[h++]=l[r+2],g[h++]=l[r+1],g[h++]=l[r],g[h++]=255,r+=
4;a.skip(4*f)}else if(1==L){if("Uint8ClampedArray"in window)for(g=new Uint32Array(d.data.buffer),h=0;h<f;h++)g[h]=Y[l[r++]];else{g=d.data;c=4*f;for(var n;h<c;)n=Y[l[r++]],g[h++]=n&255,g[h++]=n>>8&255,g[h++]=n>>16&255,g[h++]=255}a.skip(f)}R.drawImageData(d,b,e)}else{switch(L){case 4:if(0==r%4){r+=3;for(h=0;h<f;h++)l[r]=255,r+=4;d=new Uint32Array(a.getData().buffer,a.getPosition(),f)}else for(d=new Uint32Array(f),h=0;h<f;h++)d[h]=l[r++]|l[r++]<<8|l[r++]<<16|4278190080,r++;a.skip(4*f);break;case 1:d=
new Uint32Array(f);for(h=0;h<f;h++)d[h]=Y[l[r++]];a.skip(f)}A.setRGBs(b,e,c,g,d,0,c);A.postPaint(b,e,c,g)}}function ea(a,b){ba=a;ca=b;l.width=a;l.height=b;A.resize(a,b);n&&n.setSize(a,b);if(c.onresolutionchange)c.onresolutionchange(a,b)}function Va(a){if(da&&a&&(a=a.getData("text/plain"))){var b=a.length,c=new Int8Array(9+b);c[0]=147;c[1]=6;c[5]=b>>24&255;c[6]=b>>16&255;c[7]=b>>8&255;c[8]=b&255;for(var f=0;f<b;f++)c[9+f]=a.charCodeAt(f);t(c.buffer)}}function na(){K=!1;R=new Fa;aa=new pa}function va(a,
b,c,f){da&&(Ha=a,(a?1<<b:0)!=O[1]||c!=(O[2]<<8|O[3])||f!=(O[4]<<8|O[5]))&&(O[2]=a?1<<b:0,O[3]=c>>8&255,O[4]=c&255,O[5]=f>>8&255,O[6]=f&255,t(O.buffer))}function W(a,b,e){F[2]=a?1:0;F[5]=b>>24;F[6]=b>>16;F[7]=b>>8;F[8]=b;183==e?e=84:197==e&&(e=198);wa&&(F[2]=0,F[3]=0,F[4]=a?1:0,F[9]=e>>24,F[10]=e>>16,F[11]=e>>8,F[12]=e);t(F.buffer);if(c.onkey)c.onkey(a,b,e)}function Ia(a,b){var e=Da[b.toLowerCase()];e?c.writeScancode(a,e):(e=b.length,0!=e&&(1==e?c.writeKeyCode(a,b.toUpperCase().charCodeAt(0)):a&&c.writeText(b)))}
this.displayMsg=!0;this.reconnectTimes=0;this.setTitle=this.openLink=!0;this.mode=0;this.CAP_QEMU_KEY=1;var ja="object"==typeof h?h:null,ia="object"==typeof h||0<h.indexOf("/PLAY?");ia?(this.mode=1,ja&&(h=""),h+="&touchpad=on"):0<h.indexOf("/JOIN?")&&(this.mode=2,this.reconnectOnResize=!1);var y=hi5.appcfg||{img:{},toolbar:{fadable:!0}},l=hi5.tool.queryToObj(h.substring(h.indexOf("?")+1)),Q=null,Ca=!1,ga="",wa=!1;!l.width&&q&&(l.width=q,h+="&width="+q);!l.wHeight&&G&&(l.height=G,h+="&height="+G);
!l.color&&J&&(l.color=J,h+="&color="+J);l.color||(l.color=32);var ma=void 0==l.ignoreCursor||P(l.ignoreCursor),ha=void 0==l.trackCursorLocally||P(l.trackCursorLocally),c=this;this.server=l.server;this.port=parseInt(l.port,10);this.loadbalanceToken=y.loadbalanceTokenName?y.loadbalanceTokenName+"="+hi5.tool.uuid():"";this.sessionInfo={major:0,minor:0,width:0,height:0,bpp:0,bigEndian:!0,trueColor:!0};this.modifyURL=function(a){c.loadbalanceToken&&(a+="&"+c.loadbalanceToken);return a};var n=null,K=!1,
da=!1,la=0,V=null;window.$vnc=this;var C=new ya(4194304);this.running=function(){return K};var x=null,L=4,ba=1024,ca=768,Y=[-16777216,-16777180,-16777143,-16777107,-16777070,-16777034,-16776997,-16776961,-16768E3,-16767964,-16767927,-16767891,-16767854,-16767818,-16767781,-16767745,-16758528,-16758492,-16758455,-16758419,-16758382,-16758346,-16758309,-16758273,-16749312,-16749276,-16749239,-16749203,-16749166,-16749130,-16749093,-16749057,-16739840,-16739804,-16739767,-16739731,-16739694,-16739658,
-16739621,-16739585,-16730624,-16730588,-16730551,-16730515,-16730478,-16730442,-16730405,-16730369,-16721152,-16721116,-16721079,-16721043,-16721006,-16720970,-16720933,-16720897,-16711936,-16711900,-16711863,-16711827,-16711790,-16711754,-16711717,-16711681,-11206656,-11206620,-11206583,-11206547,-11206510,-11206474,-11206437,-11206401,-11197440,-11197404,-11197367,-11197331,-11197294,-11197258,-11197221,-11197185,-11187968,-11187932,-11187895,-11187859,-11187822,-11187786,-11187749,-11187713,-11178752,
-11178716,-11178679,-11178643,-11178606,-11178570,-11178533,-11178497,-11169280,-11169244,-11169207,-11169171,-11169134,-11169098,-11169061,-11169025,-11160064,-11160028,-11159991,-11159955,-11159918,-11159882,-11159845,-11159809,-11150592,-11150556,-11150519,-11150483,-11150446,-11150410,-11150373,-11150337,-11141376,-11141340,-11141303,-11141267,-11141230,-11141194,-11141157,-11141121,-5636096,-5636060,-5636023,-5635987,-5635950,-5635914,-5635877,-5635841,-5626880,-5626844,-5626807,-5626771,-5626734,
-5626698,-5626661,-5626625,-5617408,-5617372,-5617335,-5617299,-5617262,-5617226,-5617189,-5617153,-5608192,-5608156,-5608119,-5608083,-5608046,-5608010,-5607973,-5607937,-5598720,-5598684,-5598647,-5598611,-5598574,-5598538,-5598501,-5598465,-5589504,-5589468,-5589431,-5589395,-5589358,-5589322,-5589285,-5589249,-5580032,-5579996,-5579959,-5579923,-5579886,-5579850,-5579813,-5579777,-5570816,-5570780,-5570743,-5570707,-5570670,-5570634,-5570597,-5570561,-65536,-65500,-65463,-65427,-65390,-65354,
-65317,-65281,-56320,-56284,-56247,-56211,-56174,-56138,-56101,-56065,-46848,-46812,-46775,-46739,-46702,-46666,-46629,-46593,-37632,-37596,-37559,-37523,-37486,-37450,-37413,-37377,-28160,-28124,-28087,-28051,-28014,-27978,-27941,-27905,-18944,-18908,-18871,-18835,-18798,-18762,-18725,-18689,-9472,-9436,-9399,-9363,-9326,-9290,-9253,-9217,-256,-220,-183,-147,-110,-74,-37,-1],A;A?A.resize(1024,768):A=new Ja(1024,768);var U=A.getContext();this.writeKeyComb=function(a){var b=a.split("+"),c=b.length;
if(0!=c){for(var f=null,g=0;g<c;g++)a=b[g],""==a&&""==f&&(a="Add"),""!=a&&Ia(!0,a),f=a;for(g=c-1;0<=g;g--)a=b[g],""==a&&""==f&&(a="Add"),""!=a&&Ia(!1,a),f=a}};var Z=new function(){this.ws=null;this.capsLock=this.numLock=!1;this.setJoinMode=c.setJoinMode;this.requestControl=c.requestControl;this.writeKeyComb=c.writeKeyComb;this.remoteLockFlags=this.localLockFlags=0;this.checkLockFlags=!0;this.getAppMode=function(){return c.mode};this.send=function(a){K&&this.ws.send(a)};this.sendInput=function(a){c.writeRawInput(a);
if(c.onactivity)c.onactivity(a)};this.getAppInfo=function(){return c.sessionInfo.appInfo};this.onresize=function(a){};this.onorientationchange=function(a){};this.getClipData=Ka;this.onfocus=function(a){};this.fileCallback=[];this.getShareFiles=function(a,b){this.ws.send("3A5"+a);this.fileCallback.push(b)};this.notifyFiles=function(a){for(var b=this.fileCallback,c=0,f=b.length;c<f;c++)b[c](a)};this.getFile=function(a){window.open(c.getFileUrl(a))};this.removeFile=function(a){uploadMgr&&uploadMgr.fileService.remove(a)};
this.getFileLink=function(a){return xa()+"/DOWNLOAD?s="+ga+"&f="+a};this.getGateway=function(){return h};this.reconnect=function(a,b,c){};this.sendKeyboardSyncFlags=function(a){if(K){var b=this.remoteLockFlags;(b&7)!=a&&((b&4)!=(a&4)&&(W(!0,65549,58),W(!1,65549,58)),(b&2)!=(a&2)&&(W(!0,65407,69),W(!1,65407,69)),(b&1)!=(a&1)&&(W(!0,65300,70),W(!1,65300,70)));this.remoteLockFlags=this.localLockFlags=a;return!0}return!1}};void 0!=y.displayMsg&&(this.displayMsg=y.displayMsg);void 0!=y.reconnectTimes&&
(this.reconnectTimes=y.reconnectTimes);void 0!=y.openLink&&(this.openLink=y.openLink);void 0!=y.setTitle&&(this.setTitle=y.setTitle);"boolean"==typeof y.useWSS&&(h=(y.useWSS?"wss":"ws")+h.substring(h.indexOf("://")));this.getURL=function(){return h};var Wa=parseInt(l.server_bpp||l.color||24);this.getColor=function(){return Wa};this.sendPing=function(a){var b=new Uint8Array(a?2+a.length:2);b[0]=146;b[1]=0;a&&b.set(a,2);t(b.buffer)};this.startPing=function(a,b){b=b||0;Q||(Q=new hi5.tool.ResponseMonitor(function(){c.sendPing()},
function(){if(K&&c.onnoresponse)return c.onnoresponse()}));Q.setInterval(a,b);var e=new Uint8Array(4);e[0]=146;e[1]=2;e[2]=a;e[3]=b;t(e.buffer);c.sendPing()};this.stopPing=function(){Q&&Q.stop()};var T=null;this.setJoinMode=function(a){t("8E1"+a)};this.refuseControl=function(a){t("8E3"+a)};this.giveControl=function(a){t("8E4"+a)};this.requestControl=function(){t("8E2")};this.allowJoin=function(a,b){t("8EA"+a+"\t"+(b?1:0))};this.play=function(){t("F3")};this.pause=function(){t("F2")};this.scan=function(a){t("F4"+
(a?"1":"0"))};this.seek=function(a){n&&K&&(t("F4"+(a?"1":"0")+"\t"+(a/n.getScale()|0)),A.pause(!0))};this.run=function(){Ma();A.startAnimation()};this.hide=function(){n&&n.hide()};this.showMessage=function(a){c.displayMsg&&a&&hi5.notifications.notify({msg:a})};this.close=function(){Ca=!0;if(x&&K)try{for(;x&&x.readyState!=WebSocket.CLOSING&&x.readyState!=WebSocket.CLOSED;)t("85"),x.close()}finally{fa()}else fa()};hi5.browser.isChromeApp?chrome.runtime.onSuspend.addListener(fa):window.addEventListener("unload",
fa,!1);var oa=new X(12,function(a){if(82!=a.getByte()||70!=a.getByte()||66!=a.getByte())c.showMessage(__svi18n.vnc.notvnc),c.close();else{a.skip(1);c.sessionInfo.major=100*(a.getByte()-48)+10*(a.getByte()-48)+(a.getByte()-48);a.skip(1);c.sessionInfo.minor=100*(a.getByte()-48)+10*(a.getByte()-48)+(a.getByte()-48);svGlobal.logger.info("RFB major: "+c.sessionInfo.major+" minor: "+c.sessionInfo.minor);a.skip(1);a=new Uint8Array(13);for(var b=0;13>b;b++)a[b]="\u0093RFB 003.003\n".charCodeAt(b);t(a.buffer);
C.setHandler(new X(4,function(a){a=a.getBE32();var b=0,e=0;svGlobal.logger.info("sec type:"+a);switch(a){case 1:Ea();break;case 2:C.setHandler(new X(12,function(a){svGlobal.logger.info("vnc auth");var d=new Uint8Array(17);d[0]=32;a.copyToByteArray(d,1,a.getPosition(),16);a.skip(16);a=l.pwd||"";8<a.length&&(a=a.substring(0,8));var c=[0,0,0,0,0,0,0,0];b=0;for(e=a.length;b<e;b++)c[b]=a.charCodeAt(b);a=new DesCipher(c);a.encrypt(d,1,d,1);a.encrypt(d,9,d,9);t(d.buffer);C.setHandler(new X(4,qa))}));break;
case -6:C.setHandler(new X(24,function(a){svGlobal.logger.info("NTLM auth");var c=new Uint8Array(345);c[0]=33;a.copyToByteArray(c,1,a.getPosition(),24);a.skip(24);a=l.user;var d=25;if(a)for(b=0,e=a.length;b<e;b++){var f=a.charCodeAt(b);c[d++]=f&255;c[d++]=f>>8&255}d=281;if(a=l.pwd)for(b=0,e=a.length;b<e;b++)f=a.charCodeAt(b),c[d++]=f&255,c[d++]=f>>8&255;t(c.buffer);C.setHandler(new X(4,qa))}));break;default:c.showMessage(__svi18n.vnc.securityError),c.close()}}))}});C.setHandler(oa);this.refreshOutput=
function(a,b,c,f){a=a||0;b=b||0;ua(a,b,c?c-a+1:ba,f?f-b+1:ca,!1)};var sa=new X(1,function(a){var b=a.getByte();switch(b){case 0:a.skip(1);b=a.getBE16();for(var e=0;e<b;e++){var f=a.getBE16();var g=a.getBE16();var d=a.getBE16();var k=a.getBE16();var h=a.getBE32()>>>0;switch(h){case 4294967073:ea(d,k);break;case 240:case 4294967056:0!=d*k&&a.skip(((d+7)/8|0)*k*2+6);break;case 4294967057:if(0!=d*k)if(ma)a.skip(d*k*L+((d+7)/8|0)*k);else{var l;var z=a;h=(d+7)/8|0;var t=h*k;var q=d*k,M=new Uint32Array(q),
x=z.getBytes(q*L),m=z.getBytes(t),p=0,v=0;for(t=0;t<k;t++){for(l=0;l<d/8;l++){var y=m[t*h+l];for(z=7;0<=z;z--)0!=(y>>z&1)?1!=L&&(p=4278190080|(x[4*v+2]&255)<<16|(x[4*v+1]&255)<<8|x[4*v]&255):p=0,M[v++]=p}for(z=7;z>=8-d%8;z--)p=0!=(m[t*h+l]>>z&1)?1==L?0:4278190080|(x[4*v+2]&255)<<16|(x[4*v+1]&255)<<8|x[4*v]&255:0,M[v++]=p}f=new Ua(0,M,f,g,d,k,4,4*q,q/8|0);n.setCursor(f)}break;case 4294967064:break;case 0:0<d*k&&Ga(a,f,g,d,k);break;case 1:h=a.getBE16();q=a.getBE16();R.inUse?U.putImageData(U.getImageData(h,
q,d,k),f,g):(A.moveArea(h,q,d,k,f-h,g-q),A.repaint(f,g,d,k));break;case 5:Xa.decode(a,f,g,d,k);break;case 7:R.decode(a,f,g,d,k,!1);break;case 16:aa.decode(a,f,g,d,k,!1);break;case 4294967035:f=a.getByte();g=0!=(f&4);d=0!=(f&2);k=0!=(f&1);Z.remoteLockFlags=f;Z.checkLockFlags=!0;if(c.onLockKeyState)c.onLockKeyState({capsLock:g,numLock:d,scrollLock:k});svGlobal.logger.info("LED state, capsLock:"+g+" numLock:"+d+" scrollLock:"+k);break;case 4294967038:F=new Uint8Array(13);F[0]=147;F[1]=255;F[2]=0;wa=
!0;n.setUnicode(!1);if(c.oncapability)c.oncapability(c.CAP_QEMU_KEY);svGlobal.logger.warn("QEMU Ext Key enabled");break;default:svGlobal.logger.warn("Encoding "+h+" is not supported")}}ua(0,0,ba,ca,!0);break;case 1:svGlobal.logger.warn("xxx color map");break;case 2:break;case 3:a.skip(3);b=a.getBE32();0<b&&(a=a.getBytes(b),b=String.fromCharCode.apply(null,a),c.onservercopy&&c.onservercopy(b)||Ta(b)||n.copyToClip("text/plain;"+b));break;case 48:b=a.getString16LE(0,a.getEnd());ka(b);a.skip(a.getEnd()-
a.getPosition());break;default:svGlobal.logger.warn("XX PDU:"+b)}});2!=c.mode&&1!=c.mode||C.setHandler(sa);var R=new Fa,aa=new pa,Xa=new function(){var a=0,b=0;this.decode=function(c,f,g,d,h){var e=f+d,k=g+h;b=a=0;for(var l=g;l<k;l+=16)for(var t=Math.min(16,k-l),q=f;q<e;q+=16){var n=c,x=q,m=l,p=Math.min(16,e-q),v=t,y=n.getByte();if(0!=(y&1))Ga(n,x,m,p,v,!1);else if(0!=(y&2)&&(1==L?a=Y[n.getByte()]:(a=n.getByte()|n.getByte()<<8|n.getByte()<<16|4278190080,n.skip(1))),A.fillRect(x,m,p,v,a),0!=(y&4)&&
(1==L?b=Y[n.getByte()]:(b=n.getByte()|n.getByte()<<8|n.getByte()<<16|4278190080,n.skip(1))),0!=(y&8)){var p=n.getByte(),u;if(0!=(y&16))if(1==L)for(u=0;u<p;u++){b=Y[n.getByte()];var w=n.getByte();y=w>>4;v=w&15;w=n.getByte();var C=1+(w>>4);w=1+(w&15);A.fillRect(x+y,m+v,C,w,b)}else for(u=0;u<p;u++)b=n.getByte()|n.getByte()<<8|n.getByte()<<16|4278190080,n.skip(1),w=n.getByte(),y=w>>4,v=w&15,w=n.getByte(),C=1+(w>>4),w=1+(w&15),A.fillRect(x+y,m+v,C,w,b);else for(u=0;u<p;u++)w=n.getByte(),y=w>>4,v=w&15,
w=n.getByte(),C=1+(w>>4),w=1+(w&15),A.fillRect(x+y,m+v,C,w,b)}}A.postPaint(f,g,d,h)}};this.resetStatus=na;this.addSurface=function(a){n=a;ia&&a.setPlayerMode();A.setContext(n.context);U=A.getContext();a.setAutoScale(0<c.mode);a.setSize(ba,ca);a.setController(Z);a.setFastCopy(P(l.fastCopy));a.setTouchpad(P(l.touchpad));a.setClipboard(P(l.mapClipboard));a.run(99997);n.setImageCursor(!1);Ba(n);a.onclipdata=Va};var O=new Uint8Array(7);O[0]=147;O[1]=5;var Ha=!1,I=new Uint8Array(13);I[0]=147;I[1]=5;I[7]=
5;I[8]=0;this.mouseDown=function(a,b,c){va(!0,c,a,b)};this.mouseMove=function(a,b){va(Ha,0,a,b)};this.mouseUp=function(a,b,c){va(!1,c,a,b)};this.writeKeyCode=function(a,b){c.writeRawInput("8B"+(a?0:49152)+"\t"+b)};this.writeScancode=function(a,b){K&&("number"==typeof a?(c.writeRawInput("840\t"+a),c.writeRawInput("8449152\t"+a)):c.writeRawInput("84"+(a?0:49152)+"\t"+b))};this.writeText=function(a){c.writeRawInput("86"+a)};var ra={57:32,201:65365,209:65366,207:65367,199:65360,203:65361,200:65362,205:65363,
208:65364,183:65377,84:65377,197:65299,198:65299,210:65379,211:65535,184:65514,219:65515,220:65516,1:65307,14:65288,15:65289,28:65293,29:65507,42:65505,54:65506,56:65513,59:65470,60:65471,61:65472,62:65473,63:65474,64:65475,65:65476,66:65477,67:65478,68:65479,87:65480,88:65481,55:65450,69:65407,70:65300,71:65429,72:65431,73:65434,74:65453,75:65430,76:65437,77:65432,78:65451,79:65436,80:65433,81:65435,82:65438,83:65439,156:65421,157:65508,181:65455,toKeySym:function(a){a=ra[a];if(Z.localLockFlags&
2)switch(a){case 65429:a=55;break;case 65431:a=56;break;case 65434:a=57;break;case 65430:a=52;break;case 65437:a=53;break;case 65432:a=54;break;case 65436:a=49;break;case 65433:a=50;break;case 65435:a=51;break;case 65438:a=48;break;case 65439:a=46}return a||0}},Ya={260:417,728:418,321:419,317:421,346:422,352:425,350:426,356:427,377:428,381:430,379:431,261:433,731:434,322:435,318:437,347:438,711:439,353:441,351:442,357:443,378:444,733:445,382:446,380:447,340:448,258:451,313:453,262:454,268:456,280:458,
282:460,270:463,272:464,323:465,327:466,336:469,344:472,366:473,368:475,354:478,341:480,259:483,314:485,263:486,269:488,281:490,283:492,271:495,273:496,324:497,328:498,337:501,345:504,367:505,369:507,355:510,729:511,294:673,292:678,304:681,286:683,308:684,295:689,293:694,305:697,287:699,309:700,266:709,264:710,288:725,284:728,364:733,348:734,267:741,265:742,289:757,285:760,365:765,349:766,312:930,342:931,296:933,315:934,274:938,290:939,358:940,343:947,297:949,316:950,275:954,291:955,359:956,330:957,
331:959,256:960,302:967,278:972,298:975,325:977,332:978,310:979,370:985,360:989,362:990,257:992,303:999,279:1004,299:1007,326:1009,333:1010,311:1011,371:1017,361:1021,363:1022,8254:1150,12290:1185,12300:1186,12301:1187,12289:1188,12539:1189,12530:1190,12449:1191,12451:1192,12453:1193,12455:1194,12457:1195,12515:1196,12517:1197,12519:1198,12483:1199,12540:1200,12450:1201,12452:1202,12454:1203,12456:1204,12458:1205,12459:1206,12461:1207,12463:1208,12465:1209,12467:1210,12469:1211,12471:1212,12473:1213,
12475:1214,12477:1215,12479:1216,12481:1217,12484:1218,12486:1219,12488:1220,12490:1221,12491:1222,12492:1223,12493:1224,12494:1225,12495:1226,12498:1227,12501:1228,12504:1229,12507:1230,12510:1231,12511:1232,12512:1233,12513:1234,12514:1235,12516:1236,12518:1237,12520:1238,12521:1239,12522:1240,12523:1241,12524:1242,12525:1243,12527:1244,12531:1245,12443:1246,12444:1247,1548:1452,1563:1467,1567:1471,1569:1473,1570:1474,1571:1475,1572:1476,1573:1477,1574:1478,1575:1479,1576:1480,1577:1481,1578:1482,
1579:1483,1580:1484,1581:1485,1582:1486,1583:1487,1584:1488,1585:1489,1586:1490,1587:1491,1588:1492,1589:1493,1590:1494,1591:1495,1592:1496,1593:1497,1594:1498,1600:1504,1601:1505,1602:1506,1603:1507,1604:1508,1605:1509,1606:1510,1607:1511,1608:1512,1609:1513,1610:1514,1611:1515,1612:1516,1613:1517,1614:1518,1615:1519,1616:1520,1617:1521,1618:1522,1106:1697,1107:1698,1105:1699,1108:1700,1109:1701,1110:1702,1111:1703,1112:1704,1113:1705,1114:1706,1115:1707,1116:1708,1118:1710,1119:1711,8470:1712,1026:1713,
1027:1714,1025:1715,1028:1716,1029:1717,1030:1718,1031:1719,1032:1720,1033:1721,1034:1722,1035:1723,1036:1724,1038:1726,1039:1727,1102:1728,1072:1729,1073:1730,1094:1731,1076:1732,1077:1733,1092:1734,1075:1735,1093:1736,1080:1737,1081:1738,1082:1739,1083:1740,1084:1741,1085:1742,1086:1743,1087:1744,1103:1745,1088:1746,1089:1747,1090:1748,1091:1749,1078:1750,1074:1751,1100:1752,1099:1753,1079:1754,1096:1755,1101:1756,1097:1757,1095:1758,1098:1759,1070:1760,1040:1761,1041:1762,1062:1763,1044:1764,1045:1765,
1060:1766,1043:1767,1061:1768,1048:1769,1049:1770,1050:1771,1051:1772,1052:1773,1053:1774,1054:1775,1055:1776,1071:1777,1056:1778,1057:1779,1058:1780,1059:1781,1046:1782,1042:1783,1068:1784,1067:1785,1047:1786,1064:1787,1069:1788,1065:1789,1063:1790,1066:1791,902:1953,904:1954,905:1955,906:1956,938:1957,908:1959,910:1960,939:1961,911:1963,901:1966,8213:1967,940:1969,941:1970,942:1971,943:1972,970:1973,912:1974,972:1975,973:1976,971:1977,944:1978,974:1979,913:1985,914:1986,915:1987,916:1988,917:1989,
918:1990,919:1991,920:1992,921:1993,922:1994,923:1995,924:1996,925:1997,926:1998,927:1999,928:2E3,929:2001,931:2002,932:2004,933:2005,934:2006,935:2007,936:2008,937:2009,945:2017,946:2018,947:2019,948:2020,949:2021,950:2022,951:2023,952:2024,953:2025,954:2026,955:2027,956:2028,957:2029,958:2030,959:2031,960:2032,961:2033,963:2034,962:2035,964:2036,965:2037,966:2038,967:2039,968:2040,969:2041,9143:2209,9484:2210,9472:2211,8992:2212,8993:2213,9474:2214,9121:2215,9123:2216,9124:2217,9126:2218,9115:2219,
9117:2220,9118:2221,9120:2222,9128:2223,9132:2224,8804:2236,8800:2237,8805:2238,8747:2239,8756:2240,8733:2241,8734:2242,8711:2245,8764:2248,8771:2249,8660:2253,8658:2254,8801:2255,8730:2262,8834:2266,8835:2267,8745:2268,8746:2269,8743:2270,8744:2271,8706:2287,402:2294,8592:2299,8593:2300,8594:2301,8595:2302,9670:2528,9618:2529,9225:2530,9228:2531,9229:2532,9226:2533,9252:2536,9227:2537,9496:2538,9488:2539,9492:2541,9532:2542,9146:2543,9147:2544,9148:2546,9149:2547,9500:2548,9508:2549,9524:2550,9516:2551,
8195:2721,8194:2722,8196:2723,8197:2724,8199:2725,8200:2726,8201:2727,8202:2728,8212:2729,8211:2730,8230:2734,8229:2735,8531:2736,8532:2737,8533:2738,8534:2739,8535:2740,8536:2741,8537:2742,8538:2743,8453:2744,8210:2747,9001:2748,9002:2750,8539:2755,8540:2756,8541:2757,8542:2758,8482:2761,9747:2762,9665:2764,9655:2765,9675:2766,9647:2767,8216:2768,8217:2769,8220:2770,8221:2771,8478:2772,8242:2774,8243:2775,10013:2777,9644:2779,9664:2780,9654:2781,9679:2782,9646:2783,9702:2784,9643:2785,9645:2786,
9651:2787,9661:2788,9734:2789,8226:2790,9642:2791,9650:2792,9660:2793,9756:2794,9758:2795,9827:2796,9830:2797,9829:2798,10016:2800,8224:2801,8225:2802,10003:2803,10007:2804,9839:2805,9837:2806,9794:2807,9792:2808,9742:2809,8981:2810,8471:2811,8248:2812,8218:2813,8222:2814,60:2979,62:2982,175:3008,8869:3010,8970:3012,95:3014,8728:3018,9109:3020,8868:3022,8968:3027,8866:3036,8867:3068,8215:3295,1488:3296,1489:3297,1490:3298,1491:3299,1492:3300,1493:3301,1494:3302,1495:3303,1496:3304,1497:3305,1498:3306,
1499:3307,1500:3308,1501:3309,1502:3310,1503:3311,1504:3312,1505:3313,1506:3314,1507:3315,1508:3316,1509:3317,1510:3318,1511:3319,1512:3320,1513:3321,1514:3322,3585:3489,3586:3490,3587:3491,3588:3492,3589:3493,3590:3494,3591:3495,3592:3496,3593:3497,3594:3498,3595:3499,3596:3500,3597:3501,3598:3502,3599:3503,3600:3504,3601:3505,3602:3506,3603:3507,3604:3508,3605:3509,3606:3510,3607:3511,3608:3512,3609:3513,3610:3514,3611:3515,3612:3516,3613:3517,3614:3518,3615:3519,3616:3520,3617:3521,3618:3522,3619:3523,
3620:3524,3621:3525,3622:3526,3623:3527,3624:3528,3625:3529,3626:3530,3627:3531,3628:3532,3629:3533,3630:3534,3631:3535,3632:3536,3633:3537,3634:3538,3635:3539,3636:3540,3637:3541,3638:3542,3639:3543,3640:3544,3641:3545,3642:3546,3647:3551,3648:3552,3649:3553,3650:3554,3651:3555,3652:3556,3653:3557,3654:3558,3655:3559,3656:3560,3657:3561,3658:3562,3659:3563,3660:3564,3661:3565,3664:3568,3665:3569,3666:3570,3667:3571,3668:3572,3669:3573,3670:3574,3671:3575,3672:3576,3673:3577,12593:3745,12594:3746,
12595:3747,12596:3748,12597:3749,12598:3750,12599:3751,12600:3752,12601:3753,12602:3754,12603:3755,12604:3756,12605:3757,12606:3758,12607:3759,12608:3760,12609:3761,12610:3762,12611:3763,12612:3764,12613:3765,12614:3766,12615:3767,12616:3768,12617:3769,12618:3770,12619:3771,12620:3772,12621:3773,12622:3774,12623:3775,12624:3776,12625:3777,12626:3778,12627:3779,12628:3780,12629:3781,12630:3782,12631:3783,12632:3784,12633:3785,12634:3786,12635:3787,12636:3788,12637:3789,12638:3790,12639:3791,12640:3792,
12641:3793,12642:3794,12643:3795,4520:3796,4521:3797,4522:3798,4523:3799,4524:3800,4525:3801,4526:3802,4527:3803,4528:3804,4529:3805,4530:3806,4531:3807,4532:3808,4533:3809,4534:3810,4535:3811,4536:3812,4537:3813,4538:3814,4539:3815,4540:3816,4541:3817,4542:3818,4543:3819,4544:3820,4545:3821,4546:3822,12653:3823,12657:3824,12664:3825,12671:3826,12673:3827,12676:3828,12678:3829,12685:3830,12686:3831,4587:3832,4592:3833,4601:3834,8361:3839,8364:5028,338:5052,339:5053,376:5054},F=new Uint8Array(9);F[0]=
147;F[1]=4;this.writeRawInput=function(a){if(da){var b=parseInt(a.substring(0,2),16);a=a.substring(2).split("\t");var e=0;switch(b){case 128:c.mouseDown(parseInt(a[0]),parseInt(a[1]),parseInt(a[2]));return;case 129:c.mouseUp(parseInt(a[0]),parseInt(a[1]),parseInt(a[2]));return;case 130:c.mouseMove(parseInt(a[0]),parseInt(a[1]));return;case 131:b=0!=parseInt(a[2]);e=parseInt(a[0]);a=parseInt(a[1]);da&&(I[2]=b?16:8,I[3]=e>>8&255,I[4]=e&255,I[5]=a>>8&255,I[6]=a&255,I[9]=I[3],I[10]=I[4],I[11]=I[5],I[12]=
I[6],t(I.buffer));return;case 132:e=ra.toKeySym(a[1]);var f=0==a[0];W(f,e,parseInt(a[1],10));break;case 139:f=0==a[0];e=parseInt(a[1]);e=String.fromCharCode(e).toLocaleLowerCase().charCodeAt(0);W(f,e,parseInt(a[2]));break;case 134:if(!wa){f=0;for(var g=a[0].length;f<g;f++){e=a[0].charCodeAt(f);if(255<e)var d=Ya[e],e=d?d:e|16777216;W(!0,e,0);W(!1,e,0)}}}1>e&&svGlobal.logger.info("Unknowncode: "+a[1]+" type:"+b)}};var Da={" ":57,space:57,pageup:201,pagedown:209,end:207,home:199,left:203,up:200,right:205,
down:208,printscreen:183,insert:210,del:211,"delete":211,altgr:184,windows:219,windowsright:220,context:221,esc:1,backspace:14,tab:15,enter:28,meta:29,command:29,ctrl:29,shift:42,alt:56,capslock:58,f1:59,f2:60,f3:61,f4:62,f5:63,f6:64,f7:65,f8:66,f9:67,f10:68,f11:87,f12:88,numlock:69,scrolllock:70,add:78}};
